# EffectConnect Marketplaces - WooCommerce plugin

Use this plugin to connect your WooCommerce webshop with EffectConnect Marketplaces. For more information about EffectConnect, go to the [EffectConnect website](https://www.effectconnect.com "EffectConnect Website").

## Requirements

The plugin has been tested with the following requirements:

| Source      | Compatible versions |
|-------------|---------------------|
| WooCommerce | 4.0 - 6.1.1         |
| PHP | 7.1 - 8.1 |

You can check your default PHP version by running `php -v` in your SSH console.
If the default version does not match the table above, ask your server administrator how to run commands in another PHP version.
For example on some servers you can just replace `php` by `php72` (or any desired version).

## Install module

1. Download the latest release of the plugin.

2. Upload the ZIP file in your Wordpress environment (Plugins -> Add new > Upload plugin), select the downloaded file and the installation will start automatically.

3. Activate the plugin after installing.

## Configure module

1. Make sure you have a *new* EffectConnect account.

2. Create API key in EffectConnect (API > Manager API keys > Create API key).
    - Type: 'custom'
    - Permissions: 'all' (you can deselect channels you don't want to import orders for in your webshop).
    - Save the key.

3. Add a new connection in your webshop (Configure > EffectConnect > Connections) and use the API keys you just created.

> For importing orders you need to select a payment module to assign the order to.
> The EffectConnect Marketplaces plugin includes its own payment module ('EffectConnect Marketplaces Payment').
> It's recommended to use this payment module, because we can't expect other payment methods to be compatible with our plugin.

## Setup cron tasks

To activate all synchronisation processes between EffectConnect and your webshop, we use the Wordpress WP-Cron system. By default WP-Cron is only running tasks when the admin page is opened. To make sure all processes are also executed when no admin page is opened, we recommend setting up a cron task. Take a look at the  Wordpress documentation on how to do this: https://developer.wordpress.org/plugins/cron/hooking-wp-cron-into-the-system-task-scheduler/  

## Description of processes

If you want to have insight in when and what processes are running, you might install the following plugin: https://wordpress.org/plugins/wp-crontrol/

The frequency can be set up in de plugin's general 'Settings' tab and can not be modified per connection.

- Export catalog
    - Export products to EffectConnect
    - Recommended to run: once a day


- Export all offers
    - Export all stock and prices to EffectConnect
    - Recommended to run: every 30 minutes


- Export queued offers
    - Export stock and prices for products that have been changed and therefore added to the export queue (only when general setting 'Export on product change' is enabled'):
        - when the delivery time of a main product or variation has changed
        - when the cost price of a main product or variation has changed
        - when regular price of a main product or variation has changed
        - when sale price of a main product or variation has changed
        - when the stock amount of a product or combination has changed by admin
        - when the stock amount of a product or combination has changed by an order
    - Runs every minute


- Import orders
    - Import orders from EffectConnect channels into webshop:
        - orders in EffectConnect will be updated with the webshop order reference and ID
        - orders in EffectConnect will be updated with the imported status (successful or error) as an order tag - orders with this tag will not be imported again (remove the tag in EffectConnect to try to import the order again)
    - Recommended to run: every 15 minutes


- Shipment / Track & Trace export
    - You can set up in your connection when the order has to updated in EffectConnect 
        - order state was updated to {state} (select the desired {state} in the connection - order will get 'shipped' status in EffectConnect)
        - a tracking number was added to an order by the MyParcel plugin (T&T will be exported, order also will get 'shipped' status in EffectConnect - updates of T&T's won't be exported)
    - Runs every minute


- Clean log files and temporarily catalog XML files
    - Clean all XML, LOG, ZIP files that are created {days} (can be set up in the plugin's general settings) ago in the ```<woocommerce_path>wp-content/plugins/<plugin_path>/temp``` folder:
        - XML files are exported files that have been generated by the export catalog and export offers processes
        - LOG files keep track of several processes within the EffectConnect Marketplaces Plugin and can be used by the EffectConnect support team for troubleshooting in case functionality does not work as expected
        - ZIP files are created when all LOG files are downloaded in the admin
    - Runs every hour

## WPML plugin support ##

The EffectConnect Marketplaces plugin supports the WordPress Multilingual Plugin (WPML - https://wpml.org/). In the connection settings you can choose whether the WPML should be used when exporting the product catalog with the setting 'Export WPML languages'. The default behaviour (when this setting is disabled or when the WPML plugin is not installed) is that only one language is exported.

- WPML plugin installed and setting 'Export WPML languages' enabled: products with main language that is equal to the default WPML language are exported to EffectConnect. All active WPML languages are added as a translation for each product. In case a translation is missing, the default WPML language is used as a fallback.
  

- WPML plugin installed and setting 'Export WPML languages' disabled: products with main WPML language that is equal to the selected language (connection setting 'Catalog language') are exported to EffectConnect. The catalog is only exported in a single language.


- WPML plugin not installed: all products are exported to EffectConnect. The catalog is marked as language that is selected in the connection setting 'Catalog language'. 

## Product code for WooCommerce plugin support ##

The EffectConnect Marketplaces plugin supports the Product code for WooCommerce plugin (https://wordpress.org/plugins/product-code-for-woocommerce/).
In the connection settings you can use the 'Product Code' or 'Product Code 2' attribute to be exported to a fixed attribute in EffectConnect Marketplaces.

## Perfect brands for WooCommerce plugin support ##

The EffectConnect Marketplaces plugin supports the Perfect brands for WooCommerce plugin (https://wordpress.org/plugins/perfect-woocommerce-brands/).
In the connection settings you can use the 'Perfect Brands' attribute to be exported to a fixed attribute in EffectConnect Marketplaces.

> Since each fixed attribute in EffectConnect Marketplaces can only contain one value, in case a product is assigned to multiple brands, only one brand is exported. For this reason we also export the brands to a custom attribute in EffectConnect Marketplaces (a custom attribute can contain multiple values).
